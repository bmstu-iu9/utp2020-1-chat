<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>BULink</title>
    <link rel="stylesheet" type="text/css" href="/static/styles/chat.css">
    <link rel="icon" sizes="any" href="/static/media/chat/lightblue-logo.png">
    <script src="/static/scripts/pop-up-chat.js"></script>
    <script src="/static/scripts/toolbar.js"></script>
    <script src="/static/scripts/users.js"></script>
</head>
<body>
<div>
    <div class="toolbar">
        <div class="logo-toolbar">
            <div class="square-logo"></div>
        </div>
        <div id="header1" class="header">
            <p align="center" style="color: white">Ğ“Ğ»Ğ°Ğ²Ğ½Ğ°Ñ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ°</p>
        </div>
        <div id="about" class="round-button" onclick="about()">
            <div class="round-logo">
                <img class="logo" alt="about" src="/static/media/chat/Media/about.png">
            </div>
        </div>
        <div id="settings" class="round-button" onclick="settings()">
            <div class="round-logo">
                <img class="logo" alt="setting" src="/static/media/menu/settings.png">
            </div>
        </div>
        <div id="leave" class="round-button">
            <div class="round-logo">
                <img class="logo" alt="leave" src="/static/media/chat/Media/leave.png">
            </div>
        </div>
        <div id="logout" class="round-button">
            <div class="round-logo">
                <img class="round-logo" alt="logout" src="/static/media/chat/Media/logout.png">
            </div>
        </div>

        <div id="pop-up" class="round-button" onclick="popUp()">
            <div class="round-logo">
                <img class="round-logo" alt="pop-up" src="/static/media/chat/Media/open-menu.png">
            </div>
        </div>
    </div>
</div>
<div class="main">
    <div class="left-part">
        <div class="left-top-part">
            <p align="center" style="color: white">ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸ Ñ‡Ğ°Ñ‚Ğ°</p>
        </div>
        <div class="finder-square">
            <input type="text" class="user-finder" id="user-finder" oninput="findUser()"
                   placeholder="Search for users" title="Type user's login"/>
            <span id="delete-users-list" class="delete-list" onclick="deleteUsersList()">&times;</span>
        </div>
        <div id="users-list" class="users-list">
        </div>
    </div>
    <div class="right-part">
        <div class="right-top-part">
            <p align="center" style="color: white" id="roomName">ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ‡Ğ°Ñ‚Ğ°</p>
        </div>

        <!--Ğ‘Ğ»Ğ¾Ğº ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹-->
        <ul id="messages"></ul>

        <!--Ğ¤Ğ¾Ñ€Ğ¼Ğ° Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹-->
        <form class="send-form">
            <input type="text" id="m" class="WriteMessage"/>
            <input type="submit" id="submitButton" value="Send" onclick="focusmessage()" class="SendMessage"/>
        </form>

        <!--Ğ‘Ğ»Ğ¾Ğº ÑĞ¼Ğ¾Ğ´Ğ·Ğ¸(Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ¾)-->
        <button id="emoji-but" class="showEmoji">ğŸ˜€</button>
        <div class="emoji" id="emoji-block">
                <button id="ğŸ˜€" value="ğŸ˜€">ğŸ˜€</button>
                <button id="ğŸ˜ƒ" value="ğŸ˜ƒ">ğŸ˜ƒ</button>
                <button id="ğŸ˜„" value="ğŸ˜„">ğŸ˜„</button>
                <button id="ğŸ˜" value="ğŸ˜">ğŸ˜</button>
                <button id="ğŸ˜†" value="ğŸ˜†">ğŸ˜†</button>
                <button id="ğŸ˜…" value="ğŸ˜…">ğŸ˜…</button>
                <button id="ğŸ˜‚" value="ğŸ˜‚">ğŸ˜‚</button>
                <button id="ğŸ¤£" value="ğŸ¤£">ğŸ¤£</button>
                <button id="ğŸ˜Š" value="ğŸ˜Š">ğŸ˜Š</button>
                <button id="ğŸ˜‡" value="ğŸ˜‡">ğŸ˜‡</button>
                <button id="ğŸ™‚" value="ğŸ™‚">ğŸ™‚</button>
                <button id="ğŸ™ƒ" value="ğŸ™ƒ">ğŸ™ƒ</button>
                <button id="ğŸ˜‰" value="ğŸ˜‰">ğŸ˜‰</button>
                <button id="ğŸ˜Œ" value="ğŸ˜Œ">ğŸ˜Œ</button>
                <button id="ğŸ˜" value="ğŸ˜">ğŸ˜</button>
        </div>


    </div>

    </div>
</div>
<div id="about-modal" class="modal">
    <div class="body-modal">
        <div class="top-strip">
            <p class="top-text">About</p>
        </div>
        <div class="bottom-strip">
            <p class="bottom-text">Coming soon...</p>
            <div class="loader"></div>
        </div>
        <span class="close" onclick="closeModal('about-modal')">&times;</span>
    </div>
</div>
<div id="settings-modal" class="modal">
    <div class="body-modal">
        <div class="top-strip">
            <p class="top-text">Settings</p>
        </div>
        <div class="bottom-strip">
            <p class="bottom-text">Coming soon...</p>
            <div class="loader"></div>
        </div>
        <span class="close" onclick="closeModal('settings-modal')">&times;</span>
    </div>
</div>

</body>
<script src="/static/scripts/show-emoji.js"></script>
<script src="/static/scripts/add-emoji.js"></script>
<script src="/socket.io/socket.io.js"></script>
<script>
    focusmessage = function getFocus() {
        document.getElementById("m").focus();
    }

    let userName = "<%= user.name %>";
    let room = "<%= roomname %>";
    let ID = "";
    let login = "<%= user.login %>";
    let online_users = [];
    var socket = io();
    
    socket.on("new online", (data)=>{
        online_users = data.online_users;
    });

    document.getElementById("roomName").textContent = "Ğ§Ğ°Ñ‚ : " +room;

    socket.emit("join room", {username : userName, roomname : room, login: login});

    socket.on('send data',(data)=>{
        ID = data.id;
        console.log(" my ID:" + ID);
    })


    document
        .getElementsByTagName("form")[0]
        .addEventListener("submit", function (event) {
            event.preventDefault();
            socket.emit("chat message", {
                value: document.getElementById("m").value,
                user: userName,
                room: room,
                login: "<%= user.login %>"
            });

            document.getElementById("m").value = "";
        });
    socket.on("chat message", (data) => {
        console.log(data.data.user + ": " + data.id);
        displayMessage(data);
    });

    function displayMessage(data) {
        let authorClass = "";
        let divClass = "";

        if (data.id === ID) {
            console.log("This person has sent a message")
            authorClass = "me";
            divClass = "myDiv";
        } else {
            authorClass = "you";
            divClass = "yourDiv";
        }
        const div = document.createElement("div");
        div.className = divClass;
        const li = document.createElement("li");
        const p = document.createElement("p");
        p.className = "time";
        let now = new Date();
        let hours = now.getHours();
        let minutes = now.getMinutes();
        p.innerText = "" + hours + ":" + minutes;
        div.innerHTML =
            '<p class="' + authorClass + '">' + data.data.user +

            "</p>" + '<p class="message"> ' + data.data.value + "</p>" ;

        div.appendChild(p);
        li.appendChild(div);

        document.getElementById("messages").appendChild(li);

        li.scrollIntoView();
    }
</script>
</html>