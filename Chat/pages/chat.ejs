<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>BULink</title>
    <link rel="stylesheet" type="text/css" href="/static/styles/chat.css">
    <link rel="icon" sizes="any" href="/static/media/chat/white-logo.png">
    <script src="/static/scripts/pop-up-chat.js"></script>
    <script src="/static/scripts/toolbar.js"></script>
    <script src="/static/scripts/users.js"></script>
</head>
<body>
<div>
    <div class="toolbar">
        <div class="logo-toolbar">
            <div class="square-logo"></div>
        </div>
        <a href="/">
            <div id="header1" class="header">
                <p align="center" style="color: white">–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞</p>
            </div>
        </a>
        <div id="about" class="round-button" onclick="about()">
            <div class="round-logo">
                <img class="logo" alt="about" src="/static/media/chat/about.png">
            </div>
        </div>
        <div id="settings" class="round-button" onclick="settings()">
            <div class="round-logo">
                <img class="logo" alt="setting" src="/static/media/menu/settings.png">
            </div>
        </div>
        <a href="/">
            <div id="leave" class="round-button">
                <div class="round-logo">
                    <img class="logo" alt="leave" src="/static/media/chat/leave.png">
                </div>
            </div>
        </a>

        <div id="logout" class="round-button">
            <div class="round-logo">
                <img class="round-logo" alt="logout" src="/static/media/chat/logout.png">
            </div>
        </div>

        <div id="pop-up" class="round-button" onclick="popUp()">
            <div class="round-logo">
                <img class="round-logo" alt="pop-up" src="/static/media/chat/open-menu.png">
            </div>
        </div>
    </div>
</div>
<div class="main">
    <div class="left-part">
        <div class="left-top-part">
            <p align="center" style="color: white">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —á–∞—Ç–∞</p>
        </div>
        <div class="finder-square">
            <input type="text" class="user-finder" id="user-finder" oninput="findUser()"
                   placeholder="Search for users" title="Type user's login"/>
            <span id="delete-users-list" class="delete-list" onclick="deleteUsersList()">&times;</span>
        </div>
        <div id="users-list" class="users-list">
            <% Object.keys(roomusers.users).forEach (this_user => { %>
                <div class="user">
                    <p class="name"> <%= roomusers.users[this_user].username %> </p>
                    <p class="route"> <%= roomusers.users[this_user].avatar %> </p>
                </div>
            <% }) %>
        </div>
    </div>
    <div class="right-part">
        <div class="right-top-part">
            <p align="center" style="color: white" id="roomName">–ù–∞–∑–≤–∞–Ω–∏–µ —á–∞—Ç–∞</p>
        </div>

        <!--–ë–ª–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π-->
        <ul id="messages">
            <% data_messages.forEach (message=> { %>
                <li>
                    <% if(user.login !== message.login){%>
                    <div class="yourDiv">
                        <p class="you"><%= message.username%></p>
                        <p class="message"><%= message.text%> </p>
                        <p class="time"><%= message.date%> </p>
                    </div>
                    <%} else{%>
                    <div class="myDiv">
                        <p class="me"><%= message.username%></p>
                        <p class="message"><%= message.text%> </p>
                        <p class="time"><%= message.date%> </p>
                    </div>
                    <%}%>
                </li>
            <% }) %>
        </ul>


        <!--–§–æ—Ä–º–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π-->
        <form class="send-form">
            <input type="text" id="m" class="WriteMessage"/>
            <input type="submit" id="submitButton"onclick="focusmessage()" class="SendMessage">
        </form>

        <button id="emoji-but" class="showEmoji">üòÄ</button>

        <!--–ë–ª–æ–∫ —ç–º–æ–¥–∑–∏(–Ω–∞—á–∞–ª–æ)-->
        <div class="emoji" id="emoji-block">
        </div>


    </div>

    </div>
</div>
<div id="about-modal" class="modal">
    <div class="body-modal">
        <div class="top-strip">
            <p class="top-text">About</p>
        </div>
        <div class="bottom-strip">
            <p class="bottom-text"><p class="bottom-text">
            	–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã –º–µ–Ω—é:<br>
            	–°–ª–µ–≤–∞ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω—ã —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –ø–æ–∏—Å–∫–æ–≤–∏–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π. <br>
            	–î–ª—è –ø–æ–∏—Å–∫–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–≤–µ—Å—Ç–∏ –ø—Å–µ–≤–¥–æ–Ω–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –æ–∫–Ω–æ –≤–≤–æ–¥–∞, –∫–æ—Ç–æ—Ä–æ–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–Ω–æ –≤ –≤–µ—Ä—Ö–Ω–µ–π —á–∞—Å—Ç–∏. <br>
            	–ï—Å–ª–∏ –ø–æ—Å–ª–µ –ø—Å–µ–≤–¥–æ–Ω–∏–º–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å—Ç–æ–∏—Ç —Å–µ—Ä—ã–π –∫—Ä—É–∂–æ–∫, —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –≤ —Å–µ—Ç–∏. <br>
            	–ï—Å–ª–∏ –∑–µ–ª–µ–Ω—ã–π- –≤ —Å–µ—Ç–∏. <br>
            	–°–ø—Ä–∞–≤–∞ –Ω–∞—Ö–æ–¥—è—Ç—Å—è —Å–ø–∏—Å–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π, –ø–æ–ª–µ –≤–≤–æ–¥–∞ —Å–æ–æ–±—â–µ–Ω–∏—è, –≤—ã–±–æ—Ä —ç–º–æ–¥–∂–∏ –∏ –∫–Ω–æ–ø–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è. <br>
            	–î–ª—è –Ω–∞–ø–∏—Å–∞–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è —Ç—Ä–µ–±—É–µ—Ç—Å—è –≤–≤–µ—Å—Ç–∏ –µ–≥–æ –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞ –∏ –Ω–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É Enter –∏–ª–∏ –∫–Ω–æ–ø–∫—É "Submit Query", –∫–æ—Ç–æ—Ä–∞—è –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —Å–ø—Ä–∞–≤–∞ –æ—Ç –∫–Ω–æ–ø–∫–∏ —ç–º–æ–¥–∂–∏. <br>
            	–î–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —ç–º–æ–¥–∂–∏ –Ω—É–∂–Ω–æ –Ω–∞–∂–∞—Ç—å –Ω–∞ –∫–Ω–æ–ø–∫—É —Å —ç–º–æ–¥–∂–∏ –∏ –≤ –ø–æ—è–≤–∏–≤—à–µ–º—Å—è –ø–æ–ª–µ –≤—ã–±—Ä–∞—Ç—å –Ω—É–∂–Ω—ã–π –≤–∞–º —ç–º–æ–¥–∂–∏. <br>
            	–ö–Ω–æ–ø–∫–∞ "–∫–ª—é—á" –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É. <br>
            	–°–ø—Ä–∞–≤–∞ –æ—Ç –∫–Ω–æ–ø–∫–∏ "–∫–ª—é—á", —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ –≤—ã—Ö–æ–¥–∞ –∏–∑ —É—á–µ—Ç–Ω–æ–π –∑–∞–ø–∏—Å–∏.
            </p>
        </div>
        <span class="close" onclick="closeModal('about-modal')">&times;</span>
    </div>
</div>
<div id="settings-modal" class="modal">
    <div class="body-modal">
        <div class="top-strip">
            <p class="top-text">Settings</p>
        </div>
        <div class="bottom-strip">
            <p class="bottom-text">Coming soon...</p>
            <div class="loader"></div>
        </div>
        <span class="close" onclick="closeModal('settings-modal')">&times;</span>
    </div>
</div>

</body>
<script src="/static/scripts/add-users.js"></script>
<script src="/static/scripts/show-emoji.js"></script>
<script src="/static/scripts/add-emoji.js"></script>
<script src="/socket.io/socket.io.js"></script>
<script>
    focusmessage = function getFocus() {
        document.getElementById("m").focus();
    }

    let userName = "<%= user.name %>";
    let room = "<%= roomname %>";
    let ID = "";
    let login = "<%= user.login %>";
    var socket = io();


    document.getElementById("roomName").textContent = "–ß–∞—Ç : " +room;

    socket.emit("join room", {username : userName, roomname : room, login: login, gender: "<%= user.gender %>", avatar: "<%= user.avatar %>"});

    socket.on('send data',(data)=>{
        ID = data.id;
        console.log(" my ID:" + ID);
    })

    document
        .getElementsByTagName("form")[0]
        .addEventListener("submit", function (event) {
            event.preventDefault();
            socket.emit("chat message", {
                value: document.getElementById("m").value,
                user: userName,
                room: room,
                login: "<%= user.login %>"
            });

            document.getElementById("m").value = "";
        });
    socket.on("chat message", (data) => {
        console.log(data.data.user + ": " + data.id);
        displayMessage(data);
    });

    function displayMessage(data) {
        let authorClass = "";
        let divClass = "";

        if (data.id === ID) {
            console.log("This person has sent a message")
            authorClass = "me";
            divClass = "myDiv";
        } else {
            authorClass = "you";
            divClass = "yourDiv";
        }
        const div = document.createElement("div");
        div.className = divClass;
        const li = document.createElement("li");
        const p = document.createElement("p");
        p.className = "time";
        let now = new Date();
        let hours = now.getHours();
        let minutes = now.getMinutes();
        p.innerText = "" + hours + ":" + minutes;
        div.innerHTML =
            '<p class="' + authorClass + '">' + data.data.user +

            "</p>" + '<p class="message"> ' + data.data.value + "</p>" ;

        div.appendChild(p);
        li.appendChild(div);

        document.getElementById("messages").appendChild(li);

        li.scrollIntoView();
    }
</script>
</html>